# 基金市场辅助工具(实时估值正常显示)

![Star History Chart](https://api.star-history.com/svg?repos=lanZzV/fund&type=Date)

一个功能强大的金融市场实时监控工具，支持命令行和Web两种模式，可追踪基金估值、市场指数、黄金价格、行业板块和市场快讯。

## 功能特性

### 数据监控
- **基金实时估值**：实时更新基金估值、日涨幅、近30天涨跌趋势
- **市场指数**：上证指数、深证指数、创业板指、纳斯达克、道琼斯等
- **黄金价格**：中国黄金基础金价、周大福金价及历史数据
- **行业板块**：各行业板块涨跌幅、主力资金流入情况
- **7×24快讯**：实时金融市场新闻

### 智能分析
- **连涨/连跌分析**：自动计算基金连续涨跌天数和幅度
- **30天趋势**：展示近30天涨跌分布，一目了然
- **持仓标记**：支持标记持有基金（⭐显示），快速关注重点
- **彩色显示**：终端下红涨绿跌，直观易读

### 双模式运行
- **命令行模式**：快速查看，适合终端用户
- **Web界面模式**：可视化展示，支持表格排序，适合浏览器访问

## 安装

### 依赖安装

```bash
pip install -r requirements.txt
```

### 依赖包说明
- `loguru` - 日志输出
- `requests` - HTTP请求
- `tabulate` - 表格格式化
- `flask` - Web服务器（仅Web模式需要）
- `curl-cffi` - 浏览器模拟请求
- `langchain` - AI提示链框架（AI分析功能）
- `langchain-openai` - OpenAI兼容API支持
- `langchain-core` - LangChain核心组件

## 使用方法

### 命令行模式

#### 查看所有信息
```bash
python fund.py
```
或使用编译好的可执行文件：
```bash
./dist/fund.exe  # Windows
```

显示内容包括：
- 7×24快讯
- 行业板块排行
- 实时金价
- 黄金历史价格
- 近7日A股成交量
- 近30分钟上证指数
- 市场指数汇总
- 自选基金估值

#### 管理自选基金

**添加基金**
```bash
python fund.py -a
# 根据提示输入基金代码，多个代码用英文逗号分隔
# 例如：001618,161725,110011
```

**删除基金**
```bash
python fund.py -d
# 根据提示输入要删除的基金代码
```

**标记持有基金**
```bash
python fund.py -c
# 标记后的基金会在名称前显示 ⭐
```

**取消持有标记**
```bash
python fund.py -b
# 移除基金的持有标记
```

**标记基金板块**（独立功能）
```bash
python fund.py -e
# 为基金添加板块标签，独立于持有标记
# 标记后会在基金名称中显示板块信息
```

**删除板块标记**
```bash
python fund.py -u
# 删除基金的板块标签
```

**查询基金板块**
```bash
python fund.py -s
# 输入板块名称关键词，程序会列出相关的板块
# 然后可以选择具体的板块查看该板块下的基金列表
```

### AI分析命令

#### 启用AI分析
```bash
python fund.py -W           # 标准分析模式（默认）
python fund.py -f -W        # 快速分析模式（~400-500字）
python fund.py -F -W        # 快速分析模式（备用参数）
python fund.py -D -W        # 深度研究模式（ReAct Agent，10000+字）
python fund.py --deep -W    # 深度研究模式（备用参数）
python fund.py -N           # 禁用AI分析
python fund.py --no-ai      # 禁用AI分析（备用参数）
```

#### 输出AI报告到文件
```bash
python fund.py -o           # 保存到 reports/ 目录
python fund.py -o custom    # 保存到 custom/ 目录
```

### Web服务器模式

#### 启动服务
```bash
python fund_server.py
```

服务默认运行在：`http://0.0.0.0:8311`

#### 访问地址
浏览器访问：`http://localhost:8311/fund`

#### Web API

**添加基金（通过URL）**
```
http://localhost:8311/fund?add=001618,161725
```

**删除基金（通过URL）**
```
http://localhost:8311/fund?delete=001618
```

#### Web功能特性
- 所有数据表格化展示
- 支持点击表头排序（升序/降序）
- GitHub 风格 UI 设计（极简、绿色主题）
- 响应式布局
- 多线程并发获取数据，加载快速

#### Web 操作功能

在"自选基金"页面，可以直接通过页面操作基金：

**添加自选基金**
- 在"自选基金"页面顶部输入框输入基金代码（多个用逗号分隔）
- 点击"➕ 添加基金"按钮

**浮动操作栏**
- 勾选基金复选框后，页面底部会自动显示浮动操作栏
- 显示已选中的基金数量
- 取消所有勾选后，浮动操作栏自动隐藏

**删除自选基金**
- 勾选要删除的基金复选框（表格第一列）
- 点击浮动操作栏中的"🗑️ 删除"按钮
- 在弹出对话框中确认删除

**标记持有基金**
- 勾选要标记的基金复选框
- 点击浮动操作栏中的"⭐ 标记持有"按钮（⭐将显示在基金名称前）
- 在弹出对话框中确认标记
- 点击"☆ 取消持有"可移除标记

**标注板块**
- 勾选要标注的基金复选框
- 点击浮动操作栏中的"🏷️ 标注板块"按钮
- 在弹出的对话框中选择板块分类和具体板块
- 支持搜索板块名称
- 确认后板块将显示在基金名称中

## AI智能分析（可选）

程序集成了最新版本的**LangChain (0.3.27+)**，使用**提示链（Prompt Chain）模式**生成深度AI分析报告。

### 三种分析模式

程序支持三种不同的AI分析模式，满足不同场景需求：

#### 标准模式（默认）
```bash
python fund.py -W      # 启用AI分析
```
- **输出长度**：1,200-1,600字（4个维度 × 300-400字）
- **生成时间**：2-3分钟
- **token消耗**：4,000-6,000
- **适用场景**：日常快速查看，平衡速度和质量

#### 快速模式
```bash
python fund.py -f -W   # 快速分析
# 或
python fund.py -F -W
```
- **输出长度**：400-500字（简明报告）
- **生成时间**：30-60秒
- **token消耗**：~1,000
- **适用场景**：快速浏览市场概况，节省成本

#### 深度研究模式
```bash
python fund.py -D -W   # 深度研究模式
# 或
python fund.py --deep -W
```
- **输出长度**：10,000-12,000字（专业行研报告）
- **生成时间**：5-10分钟
- **token消耗**：~20,000
- **成本**：约为标准模式的**6倍**
- **特色功能**：
  - 🤖 **ReAct Agent自主研究**：Agent自主决定数据收集策略
  - 🌍 **多源信息交叉验证**：使用DuckDuckGo搜索国际媒体报道
  - 📰 **网页深度抓取**：获取完整新闻文章内容
  - 🔍 **官方vs市场视角对比**：明确区分官方快讯与独立媒体观点
  - 📊 **详尽的量化分析**：每个事件500-1000字深度解读
  - 💼 **具体操作计划**：可执行的交易策略和触发条件
- **适用场景**：周末复盘、重要决策前的全面研究、专业投资分析

**模式对比表**：

| 特性 | 快速模式 | 标准模式 | 深度研究模式 |
|------|---------|---------|-------------|
| 字数 | 400-500 | 1,200-1,600 | 10,000-12,000 |
| 时间 | 30-60秒 | 2-3分钟 | 5-10分钟 |
| Token | ~1,000 | ~4,000-6,000 | ~20,000 |
| 成本 | ¥0.002 | ¥0.01-0.02 | ¥0.06-0.12 |
| 信息源 | 本地数据 | 本地数据 | 本地+网络搜索 |
| 分析深度 | 概要 | 标准 | 专业级 |

### 配置方式

#### 方式1：使用.env文件（推荐）

创建 `.env` 文件：
```bash
LLM_API_KEY=your-api-key
LLM_API_BASE=https://api.moonshot.cn/v1
LLM_MODEL=moonshot-v1-8k
```

或者使用DeepSeek：
```bash
LLM_API_KEY=your-api-key
LLM_API_BASE=https://api.deepseek.com/v1
LLM_MODEL=deepseek-chat
```

运行：
```bash
./run.sh  # 自动加载配置并启动
```

#### 方式2：临时配置

```bash
export LLM_API_KEY="your-api-key"
export LLM_API_BASE="https://api.deepseek.com/v1"
export LLM_MODEL="deepseek-chat"

python3 fund.py
```

#### 方式3：永久配置

在 `~/.bashrc` 或 `~/.zshrc` 添加：
```bash
export LLM_API_KEY="your-api-key"
export LLM_API_BASE="https://api.deepseek.com/v1"
export LLM_MODEL="deepseek-chat"
```

然后 `source ~/.bashrc` 生效。

### 支持的AI服务

OpenAI兼容格式，推荐标准模式用thinking模型，深度研究模式使用控制工具厉害的模型如claude-sonnet或kimi-k2

### 禁用AI分析

使用-N或者--no-ai参数即可禁用AI分析，不配置 `LLM_API_KEY` 也可以。

## 打包为可执行文件

使用 PyInstaller 将程序打包为独立的可执行文件：

```bash
pyinstaller fund.spec
```

打包完成后，可执行文件位于 `dist/fund.exe`（Windows）或 `dist/fund`（Linux/Mac）。

## 数据展示说明

### 终端显示（CLI模式）

**颜色说明：**
- 红色：上涨/涨幅为正
- 绿色：下跌/跌幅为负

**基金数据列：**
1. **基金代码** - 6位数字代码
2. **基金名称** - 带⭐表示持有
3. **估值时间** - 最新估值的时间
4. **估值** - 当日实时估值涨跌幅
5. **日涨幅** - 前一交易日涨跌幅
6. **连涨天数** - 正数表示连涨，负数表示连跌
7. **连涨幅** - 连涨/连跌的累计幅度
8. **涨/总 (近30天)** - 近30天上涨天数/总天数
9. **总涨幅** - 近30天累计涨跌幅

### Web界面

**交互功能：**
- 点击表头可排序（再次点击切换升序/降序）
- 可排序的列会显示排序箭头指示器
- 表格使用现代化设计，白底蓝色边框

## 免责声明

本工具仅提供数据展示功能，不构成任何投资建议。投资有风险，入市需谨慎。
